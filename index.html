<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baba Society ‚öΩ</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#22c55e">

    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --primary: #22c55e;
            --secondary: #38bdf8;
            --accent: #6366f1;
            --danger: #ef4444;
            --warning: #facc15;
            --text: #f8fafc;
            --text-muted: #94a3b8;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; /* Remove o brilho ao tocar no mobile */
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: var(--text);
            line-height: 1.4;
            padding-bottom: env(safe-area-inset-bottom); /* Suporte para iPhones novos */
        }

        .container {
            width: 100%;
            max-width: 600px; /* Limite para n√£o ficar largo demais em tablets */
            margin: auto;
            padding: 16px;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 800;
            text-align: center;
            margin: 10px 0 25px 0;
            background: linear-gradient(to right, #22c55e, #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 1.1rem;
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        /* Melhoria nos Inputs para Mobile */
        input, select {
            width: 100%;
            height: 48px; /* Altura ideal para toque */
            padding: 0 12px;
            margin-bottom: 10px;
            border-radius: 10px;
            border: 2px solid #334155;
            background: #0f172a;
            color: white;
            font-size: 16px; /* Evita zoom autom√°tico no iOS ao focar */
            appearance: none;
        }

        input:focus { outline: none; border-color: var(--primary); }

        /* Bot√µes robustos para o polegar */
        button {
            border: none;
            border-radius: 12px;
            min-height: 48px;
            padding: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.97); opacity: 0.9; }

        .btn-primary { background: var(--primary); color: #052e16; }
        .btn-secondary { background: var(--secondary); color: #082f49; }
        .btn-warning { background: var(--warning); color: #422006; }
        .btn-danger { background: var(--danger); color: white; }
        .full-width { width: 100%; margin-bottom: 8px; }

        /* Grid de Jogadores - 2 colunas no celular */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .player-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid #334155;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
        }

        .player-box.player-added {
            border-color: var(--primary);
            background: rgba(34, 197, 94, 0.1);
        }

        .player-name {
            display: block;
            font-weight: bold;
            font-size: 0.95rem;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .badge-pos {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: #334155;
            color: var(--text-muted);
        }

        .stars { color: var(--warning); margin: 6px 0; font-size: 0.7rem; }

        .actions { display: grid; grid-template-columns: 1fr 2fr; gap: 5px; margin-top: 10px; }
        .small-btn { min-height: 38px; padding: 5px; font-size: 12px; border-radius: 8px; }

        /* Lista de "Confirmados" em chips compactos */
        .today-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 15px;
        }

        .chip {
            background: var(--accent);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Times */
        .teams-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .team-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 14px;
            border-left: 4px solid var(--secondary);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>

<body>
<div class="container">
    <h1>Baba Society ‚öΩ</h1>

    <div class="card">
        <h2 id="formTitle">üë§ Novo Jogador</h2>
        <input id="nameInput" placeholder="Nome do craque" spellcheck="false">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <select id="position">
                <option>Zagueiro</option>
                <option>Meia</option>
                <option>Atacante</option>
            </select>
            <select id="rating"></select>
        </div>
        <button class="btn-primary full-width" onclick="savePlayer()" id="saveBtn">Salvar Jogador</button>
        <button class="btn-secondary full-width" onclick="cancelEdit()" id="cancelBtn" style="display:none">Cancelar</button>
    </div>

    <div class="card">
        <h2>üìÖ No Baba hoje (<span id="count">0</span>)</h2>
        <div id="todayPlayers" class="today-list"></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button class="btn-secondary" onclick="drawTeams()">üé≤ Sortear</button>
            <button class="btn-primary" onclick="shareWhatsApp()">üì≤ Zap</button>
        </div>
    </div>

    <div class="card">
        <h2>üìã Elenco Salvo</h2>
        <div id="savedPlayers" class="players-grid"></div>
    </div>

    <div class="card" id="resultsCard" style="display:none">
        <h2>üèÜ Times Sorteados</h2>
        <div id="teams" class="teams-container"></div>
    </div>
</div>

<script>
/* Toda a l√≥gica do script permanece a mesma para manter a funcionalidade que voc√™ j√° validou */
let players = JSON.parse(localStorage.getItem("players")) || [];
let today = [];
let editingIndex = null;
let lastTeams = [];
let lastLeftovers = [];

const nameInput = document.getElementById("nameInput");
const positionSelect = document.getElementById("position");
const ratingSelect = document.getElementById("rating");
const savedPlayersDiv = document.getElementById("savedPlayers");
const todayPlayersDiv = document.getElementById("todayPlayers");
const teamsDiv = document.getElementById("teams");
const countSpan = document.getElementById("count");

for(let i=1; i<=10; i++){
    const o = document.createElement("option");
    o.value = i;
    o.textContent = "‚≠ê".repeat(i);
    ratingSelect.appendChild(o);
}

const stars = n => "‚≠ê".repeat(n);
const posEmoji = p => p === "Zagueiro" ? "üõ°Ô∏è" : p === "Meia" ? "üéØ" : "‚öΩ";

function savePlayer(){
    const name = nameInput.value.trim();
    if(!name) return;
    const pos = positionSelect.value;
    const rat = parseInt(ratingSelect.value);

    if(editingIndex !== null){
        players[editingIndex].position = pos;
        players[editingIndex].rating = rat;
        cancelEdit();
    } else {
        if(players.some(p => p.name.toLowerCase() === name.toLowerCase())){
            alert("J√° cadastrado!");
            return;
        }
        players.push({name, position: pos, rating: rat});
    }
    localStorage.setItem("players", JSON.stringify(players));
    nameInput.value = "";
    renderSaved();
}

function editPlayer(i){
    const p = players[i];
    nameInput.value = p.name;
    nameInput.disabled = true;
    positionSelect.value = p.position;
    ratingSelect.value = p.rating;
    editingIndex = i;
    document.getElementById("formTitle").textContent = "üìù Editar";
    document.getElementById("saveBtn").textContent = "Atualizar";
    document.getElementById("cancelBtn").style.display = "block";
    window.scrollTo({top: 0, behavior: 'smooth'});
}

function cancelEdit(){
    editingIndex = null;
    nameInput.value = "";
    nameInput.disabled = false;
    document.getElementById("formTitle").textContent = "üë§ Novo Jogador";
    document.getElementById("saveBtn").textContent = "Salvar Jogador";
    document.getElementById("cancelBtn").style.display = "none";
}

function toggleToday(name){
    const p = players.find(x => x.name === name);
    const index = today.indexOf(p);
    if(index > -1) today.splice(index, 1);
    else today.push(p);
    renderToday(); 
    renderSaved();
}

function renderSaved(){
    savedPlayersDiv.innerHTML = "";
    players.forEach((p, i) => {
        const added = today.includes(p);
        savedPlayersDiv.innerHTML += `
            <div class="player-box ${added ? 'player-added' : ''}">
                <span class="player-name">${p.name}</span>
                <span class="badge-pos">${posEmoji(p.position)}</span>
                <div class="stars">${stars(p.rating)}</div>
                <div class="actions">
                    <button class="small-btn btn-warning" onclick="editPlayer(${i})">‚úèÔ∏è</button>
                    <button class="small-btn ${added ? 'btn-danger' : 'btn-primary'}" onclick="toggleToday('${p.name}')">
                        ${added ? 'Remover' : 'Adicionar'}
                    </button>
                </div>
            </div>`;
    });
}

function renderToday(){
    countSpan.textContent = today.length;
    todayPlayersDiv.innerHTML = today.map(p => `
        <div class="chip">
            ${p.name} <span onclick="toggleToday('${p.name}')">√ó</span>
        </div>`).join("");
}

function drawTeams(){
    if(today.length < 12){
        alert("M√≠nimo de 12 jogadores!");
        return;
    }
    const TEAM_SIZE = 6;
    const teamCount = Math.floor(today.length / TEAM_SIZE);
    const shuffled = [...today].sort(() => Math.random() - 0.5);
    let teams = Array.from({length: teamCount}, () => []);
    let usable = shuffled.slice(0, teamCount * TEAM_SIZE);
    lastLeftovers = shuffled.slice(teamCount * TEAM_SIZE);
    usable.sort((a, b) => b.rating - a.rating);
    usable.forEach((player, index) => {
        teams[index % teamCount].push(player);
    });
    lastTeams = teams;
    renderTeams(teams, lastLeftovers);
    const res = document.getElementById("resultsCard");
    res.style.display = "block";
    res.scrollIntoView({behavior: 'smooth'});
}

function renderTeams(teams, leftovers){
    teamsDiv.innerHTML = "";
    teams.forEach((t, i) => {
        const avg = (t.reduce((s, p) => s + p.rating, 0) / t.length).toFixed(1);
        const captain = t.reduce((a, b) => b.rating > a.rating ? b : a).name;
        teamsDiv.innerHTML += `
            <div class="team-card">
                <div class="team-header">
                    <strong>Time ${captain}</strong>
                    <span style="color:var(--warning)">‚≠ê ${avg}</span>
                </div>
                <div style="font-size: 0.9rem; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                    ${t.map(p => `<div>${posEmoji(p.position)} ${p.name}</div>`).join("")}
                </div>
            </div>`;
    });
    if(leftovers.length){
        teamsDiv.innerHTML += `
            <div class="team-card" style="border-left-color: var(--danger)">
                <div class="team-header"><strong>Pr√≥xima Rodada</strong></div>
                <div style="font-size: 0.85rem; opacity: 0.8;">
                    ${leftovers.map(p => p.name).join(", ")}
                </div>
            </div>`;
    }
}

function shareWhatsApp(){
    if(!lastTeams.length) return alert("Sorteie primeiro!");
    let text = "‚öΩ *TIMES DO BABA* ‚öΩ\n\n";
    lastTeams.forEach((t, i) => {
        const captain = t.reduce((a, b) => b.rating > a.rating ? b : a).name;
        text += `*Time ${captain}:*\n${t.map(p => `- ${p.name}`).join("\n")}\n\n`;
    });
    if(lastLeftovers.length) text += `*Fora:*\n${lastLeftovers.map(p => p.name).join(", ")}`;
    window.open("https://wa.me/?text=" + encodeURIComponent(text));
}

renderSaved();
renderToday();
</script>
</body>
</html>
